# 아이디어 노트 & 아키텍처 결정 (Idea & Architecture Decisions)

## 1. 실시간 접속자 수 카운팅 (Real-time Online User Counting)
**목표:** 서비스가 활발하게 운영되고 있음을 시각적으로 보여주어 유저의 체류 시간과 참여도를 높임 (Social Proof).

### 1-1. 아키텍처 결정: WebSocket vs Polling vs Hybrid
실시간 기능을 구현하는 방법은 여러 가지가 있으나, 현재 프로젝트 단계(MVP)와 리소스 효율성을 고려하여 **Polling + Hybrid Tracking** 방식을 채택함.

| 방식 | 설명 | 장점 | 단점 | 채택 여부 |
| :--- | :--- | :--- | :--- | :--- |
| **WebSocket** | 서버와 영구 연결을 맺고 실시간 통신 (Socket.io 등) | 리얼타임성 최강, 즉시 반영 | 서버 리소스 과다 소모, 연결 유지 비용 큼, 구현 복잡 | X |
| **Simple Polling** | 프론트가 n초마다 API 호출 | 구현이 매우 쉬움 | 불필요한 트래픽 발생, 서버 부하 가능성 | △ |
| **Hybrid Tracking** | **Active(API호출) + Passive(Heartbeat)** | 리소스 효율적, 정확도 높음 | 로직 분산 (프론트/백엔드 조율 필요) | **O (채택)** |

### 1-2. 채택 상세 로직 (Hybrid Tracking)
우리는 유저가 **"실제로 보고 있는가?"**를 판단하기 위해 두 가지 신호를 조합함.

1.  **능동적 신호 (Active Signal)**:
    *   유저가 좋아요, 댓글, 채팅 등 API를 호출하는 행위.
    *   백엔드 `get_current_user` 의존성 함수(`Depends`)에 `update_last_active()`를 심어두어, **모든 인증된 API 호출 시 자동으로 마지막 활동 시간이 갱신됨.**
    *   **장점:** 별도의 오버헤드 없이 자연스럽게 활동 추적 가능.

2.  **수동적 신호 (Passive Heartbeat)**:
    *   유저가 아무것도 안 하고(API 호출 없이) 영상만 시청하거나 글을 읽는 상황(눈팅)을 고려.
    *   프론트엔드에서 **1분마다** 가벼운 `/api/auth/heartbeat` API를 호출.
    *   **장점:** 멍하니 보고 있는 유저도 '접속 중'으로 정확히 카운트 가능.

### 1-3. 카운팅 쿼리 최적화
*   **기준:** `last_active_at`이 `현재 시간 - 5분` 이내인 유저. (5분 동안 아무 반응 없으면 나간 걸로 간주)
*   **쿼리:** `SELECT COUNT(*) FROM user WHERE last_active_at >= :limit_time`
*   **성능 고려:** `last_active_at` 컬럼에 Index를 걸어주면 수십만 명 규모에서도 조회 속도가 0.01초 이내로 유지됨. (현재는 규모가 작아 Index 없이도 충분)

### 1-4. 왜 Redis를 안 썼는가? (Why not Redis?)
*   보통 실시간 카운팅은 Redis `HyperLogLog`나 `Set`을 많이 사용함.
*   하지만 현재 우리는 RDB(PostgreSQL)만으로도 충분히 처리가 가능하며, **인프라 복잡도를 낮추기 위해(Keep It Simple)** 초기 단계에서는 RDB 방식을 선택.
*   추후 동시 접속자가 1만 명을 넘어가면 Redis로 마이그레이션 예정.

---

## 2. 마이페이지 UX/UI 전략 (Thumb Zone)
**목표:** 모바일 사용자에게 최적화된 내비게이션 경험 제공.

### 2-1. 하단 탭 vs 상단 메뉴
*   **분석:** 스마트폰 대형화로 인해 화면 상단은 손이 닿기 힘든 영역(Hard Zone)이 됨.
*   **결정:**
    *   **내 정보(Profile)**: 가장 빈번하게 접근하는 개인화 메뉴이므로 **오른쪽 하단 탭(Thumb Zone)**에 배치.
    *   **앱 상태(Status)**: 접속자 수와 같이 '정보 확인' 용도의 데이터는 **상단 우측**에 배치하여 시각적 정보 전달 역할만 수행.

### 2-2. 로그인 상태 시각화
*   로그인 전: 일반 아이콘 표시.
*   로그인 후: **유저의 프로필 사진(Avatar)**으로 아이콘 교체. -> "내가 로그인되어 있다"는 직관적인 피드백 제공 (인스타그램, 유튜브 UX 차용).
