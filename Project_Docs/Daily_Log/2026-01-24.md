=== 유튜브 구독 시스템 리팩토링 (2026-01-24) ===

1. 기존 문제점
   - 발굴(Discover) 즉시 DB에 저장됨
   - 사용자가 명시적으로 구독 의사를 표현할 수 없음
   - 개인별 구독 리스트 관리 불가

2. 개선 방향
   - 발굴은 임시 결과만 표시 (DB 저장 X)
   - 구독 버튼 클릭 시에만 DB 저장
   - 내 구독 리스트를 별도 UI로 관리

3. DB 구조 변경

   [기존 테이블]
   youtube_channels (공용 채널 정보 캐싱)
     - id (PK)
     - channel_id (YouTube ID, Unique)
     - name (채널명)
     - keywords (발견 키워드)
     - created_at

   [신규 테이블]
   user_subscriptions (개인 구독 관계)
     - id (PK)
     - user_id (FK -> user.id)
     - channel_id (FK -> youtube_channels.id)
     - created_at
     - 제약: (user_id, channel_id) Unique (중복 구독 방지)

4. Backend API 설계

   [발굴 API - 기존 유지, 로직만 변경]
   GET /api/youtube/discover?interest=음악
   - 기능: YouTube API로 채널 검색
   - 변경점: DB에 저장하지 않고 임시 결과만 반환
   - 응답: 채널 리스트 (channel_id, name, thumbnail...)

   [구독하기 API - 신규]
   POST /api/youtube/subscribe
   Body: { channel_id: "UCxxx", channel_name: "채널명" }
   - 기능: 
     1. youtube_channels에 채널 정보 저장 (없으면 생성)
     2. user_subscriptions에 유저-채널 관계 저장
   - 인증: JWT 토큰 필수
   - 응답: { success: true, message: "구독 완료" }

   [구독 취소 API - 신규]
   DELETE /api/youtube/unsubscribe/{channel_id}
   - 기능: user_subscriptions에서 해당 레코드 삭제
   - 응답: { success: true }

   [내 구독 리스트 조회 - 신규]
   GET /api/youtube/my-subscriptions
   - 기능: 현재 유저가 구독한 채널 목록 반환
   - 인증: JWT 토큰 필수
   - 응답: [{ channel_id, name, thumbnail, subscribed_at }, ...]

5. Frontend UI 구조

   [Youtube Lounge 탭 구성]
   - 발굴 탭 (기존 유지, 버튼 추가)
     - 관심사 입력 -> API 호출
     - 채널 카드 표시
     - 각 카드에 "구독하기" 버튼 추가
     - 버튼 클릭 -> POST /subscribe

   - 내 구독 탭 (신규)
     - GET /my-subscriptions 호출
     - 구독 채널 목록 그리드 표시
     - "구독 취소" 버튼

6. 구현 순서
   1단계: DB 모델 추가 (user_subscriptions)
   2단계: Backend API 구현 (subscribe, unsubscribe, my-subscriptions)
   3단계: Alembic 마이그레이션 실행
   4단계: Frontend 컴포넌트 수정 (구독 버튼 + 내 구독 탭)

8. 추가 구현 사항 (RSS 비용 절감 최적화)
   - [문제] 검색된 채널 중 활동하지 않는 '유령 채널'이 섞여있어 사용자 경험 저하 + 불필요한 API 호출 우려
   - [해결 전략] '하이브리드 필터링' 도입
     1. 검색은 넉넉하게 50개 수행 (API 1 call = 100 cost, 개수 상관없음)
     2. 백엔드에서 즉시 RSS 피드(무료)를 찔러서 최신 영상 유무 확인
     3. 영상이 있는 채널만 선별하여 목표 개수(15개)가 찰 때까지 수집
     4. 프론트엔드엔 "100% 영상이 있는 알짜 채널"만 전달
   - [효과] API 비용은 그대로 유지하면서 콘텐츠 품질 및 로딩 속도 비약적 상승

9. UI/UX 최종 개선
   - [구독 시스템] 발굴 리스트에서 '구독' 클릭 시 리스트에서 즉시 제거 + 사이드바 이동
   - [사이드바] 우측 토글 형태로 내 구독 리스트 관리. 클릭 시 해당 채널 영상 무료 로딩(RSS)
   - [버튼 인터랙션] 구독/취소 시 새로고침 없이 즉각 상태 반영 (Optimistic UI)

10. 재사용 가능한 사용자 프로필 컴포넌트 개발 (2026-01-24)
    [목적]
    - 접속 이웃 클릭 시 해당 사용자 정보 팝업 형태로 표시
    - 마이페이지 및 다른 사용자 프로필 조회 시 동일 컴포넌트 재활용
    - 향후 AI 기반 취향 분석 기능을 위한 UI 기반 마련

    [Backend API 3종 추가]
    1. GET /api/auth/profile/:user_id
       - 특정 사용자 프로필 정보 조회 (닉네임, 이메일, 가입일, 마지막 활동)
       - 민감 정보는 필터링하여 공개용으로 제공

    2. GET /api/youtube/user/:user_id/history
       - 특정 사용자의 시청 기록 조회 (최근 20개)
       - 기존 service.get_view_history 재활용, user_id만 파라미터화

    3. GET /api/youtube/user/:user_id/subscriptions
       - 특정 사용자의 구독 채널 목록 조회
       - 기존 get_my_channels 재활용, user_id만 파라미터화

    [Frontend 컴포넌트]
    - UserProfile.jsx
      - 모달 형태의 프로필 뷰어
      - 3개 탭 구성: 시청 기록 / 구독 채널 / AI 취향 분석(예정)
      - 병렬 데이터 로딩 (Promise.all)으로 빠른 렌더링
      - 프로필 헤더: 아바타, 닉네임, 가입일
      - 스크롤 가능한 컨텐츠 영역 (최대 400px)

    - UserProfile.css
      - Glassmorphism 디자인
      - 모달 애니메이션 (fadeIn + slideUp)
      - 커스텀 스크롤바 (purple accent)
      - 호버 효과로 인터랙티브 경험 강화

    [Integration Point]
    - OnlineUsersModal.jsx에 연동
      - 사용자 카드 클릭 시 selectedUserId 설정
      - UserProfile 컴포넌트 렌더링 (조건부)
      - 자기 자신 클릭은 무시
      - 호버 효과 강화 (transform + 그림자)

    [향후 확장]
    - AI 키워드 추출 API 연동 (GET /api/user/:user_id/keywords)
    - 취향 일치도 분석 (사용자 간 관심사 매칭 %)
    - 친구 추가 / 메시지 보내기 기능 통합
