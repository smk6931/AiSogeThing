================================================================================
                        AI 웹툰 생성 프로세스 설계서
================================================================================

작성일: 2026-01-27
수정일: 2026-01-28 (구현 완료 반영)
목적: LangGraph + Google GenAI를 활용한 자동 웹툰 생성 워크플로우

================================================================================
1. 사용자 입력 (Input Schema)
================================================================================

    1. 인물 갯수 (character_count)
       - 타입: Integer
       - 예시: 2 (남녀 주인공)
    
    2. 인물 설명 (character_descriptions)
       - 타입: String
       - 예시: "남자 주인공: 20대 후반, 키 큰 직장인, 차가운 외모
                여자 주인공: 20대 중반, 밝고 활발한 카페 직원"
    
    3. 컷 갯수 (scene_count)
       - 타입: Integer
       - 예시: 4 (4컷 만화)
    
    4. 글 길이 (script_length)
       - 타입: String (short/medium/long)
       - 예시: "medium" (각 씬당 50-100 단어)
    
    5. 줄거리 내용 (story_topic)
       - 타입: String
       - 예시: "비 오는 날 우연히 만난 두 사람의 첫 만남"

================================================================================
2. GenAI 모델 선택
================================================================================

    텍스트/이미지 통합: gemini-2.0-flash (속도 및 성능 최적화)
    참고: Google GenAI API 사용 (GOOGLE_API_KEY 환경변수 필요)

================================================================================
3. LangGraph 워크플로우 설계 (구현 완료)
================================================================================

    [State 구조]
    - user_input: dict (입력 데이터)
    - full_script: str (생성된 전체 스토리 + 요약)
    - character_visuals: list[dict] (인물별 외형 묘사 + 이미지 경로)
    - scenes: list[dict] (각 씬별 텍스트 + 이미지 경로)
    - novel_id: int (DB 저장된 Novel ID)
    - current_step: str (현재 진행 단계)

    -----------------------------------------------------------------------
    Node 1: ScriptWriter (줄거리/대본 생성)
    -----------------------------------------------------------------------
        - 입력: Topic, Characters
        - 출력: 한국어 대본 ([Summary] 섹션 및 [Scene] 섹션 포함)
        - DB Update: novel.script

    -----------------------------------------------------------------------
    Node 2: CoverDesigner (표지 생성)
    -----------------------------------------------------------------------
        - 입력: Topic
        - 출력: 표지 이미지 생성 및 저장
        - DB Update: novel.thumbnail_image

    -----------------------------------------------------------------------
    Node 3: CharacterDesigner (인물 분석)
    -----------------------------------------------------------------------
        - 입력: Script
        - 출력: 캐릭터별 외형 묘사 (Korean) JSON 추출
        - DB Update: novel.character_descriptions (JSON String)

    -----------------------------------------------------------------------
    Node 4: CharacterImageGenerator (인물 프로필 생성)
    -----------------------------------------------------------------------
        - 입력: Character Visuals
        - 출력: 각 캐릭터별 프로필 이미지 생성
        - DB Update: novel.character_descriptions (이미지 경로 포함)

    -----------------------------------------------------------------------
    Node 5: SceneSplitter (콘티 분할)
    -----------------------------------------------------------------------
        - 입력: Script
        - 출력: 씬별 텍스트 분할 및 DB 선저장
        - DB Update: novel_cuts (Text only)

    -----------------------------------------------------------------------
    Node 6: SceneImageGenerator (컷 생성)
    -----------------------------------------------------------------------
        - 입력: Scenes, Character Visuals
        - 출력: 단일 컷(Single Panel) 고품질 웹툰 일러스트 생성
        - 특징: 캐릭터 일관성 유지를 위해 Visual Description 주입
        - DB Update: novel_cuts (Image Path)

================================================================================
4. 시스템 특징 및 고도화 (Advanced Features)
================================================================================

    1. Real-time Feedback (실시간 피드백)
       - Polling 구조 (2초 간격)를 통해 생성 과정을 실시간으로 UI에 반영
       - Skeleton Loading 및 진행 상태 표시

    2. Error Handling & Rollback (에러 복구)
       - 생성 중 에러 발생 시 자동 감지
       - DB 롤백(데이터 삭제) 수행하여 불완전한 데이터 잔존 방지
       - 사용자에게 Alert 및 리스트 복귀 처리

    3. High-Quality Single Layout
       - 각 씬을 한 장의 고품질 일러스트로 꽉 차게 표현
       - Gemini Prompt Engineering 활용하여 작화 품질 극대화

    4. Responsive UI
       - 모바일 최적화 (2열 그리드)
       - 직관적인 카드/포스터형 레이아웃

================================================================================
5. 파일 구조 (최신)
================================================================================

    back/
      novel/
        langgraph_workflow.py    # Main Workflow Logic
        image_service.py         # Image Gen Service (Prompt Engineering)
        service.py               # DB CRUD (Transaction safe)
        router.py                # API Endpoints
      
    static/
      generated/                 # Generated Assets (Covers, Characters, Scenes)
    
    front/
      src/
        pages/Novel/
          NovelList.jsx          # Gallery List UI
          NovelView.jsx          # Detail & Progress UI
          NovelCreate.jsx        # Creation Form

================================================================================
